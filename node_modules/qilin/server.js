var http = require('http');
function start(route,handler,option){
	function onRequest(req,res){
		var portPos = req.headers.host.indexOf(":");
		var host = portPos !== -1 ? req.headers.host.slice(0,portPos) : req.headers.host;
		//host 路由
		//console.log('host',host);
		var vhostsOpt = option.vhosts[host], postData = "";
		//console.log(vhostsOpt);
		if(req.method.toLowerCase() == "get") {
			route(req,res,handler,vhostsOpt);
			return;
		}
		req.addListener("data",function(data){
			postData += data;
		});
		req.addListener("end",function(data){
			route(req,res,handler,vhostsOpt,postData);
		});
	}
	try{
		http.createServer(onRequest).listen(option.port,option.ip);
		console.log("server start at ip: " + option.ip + " port: " + option.port);
	}catch(e){
		console.log("error: " + e.message + " check config file");
	}
}
exports.start = start;

